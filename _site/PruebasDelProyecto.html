<!DOCTYPE html>
<html>

<head>
	<!-- Meta -->
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<meta name="generator" content="Jekyll">

	<title>Pruebas Notebook</title>

	<!-- CSS & fonts -->
	<link rel="stylesheet" href="/css/main.css">
	<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,900,400italic%7CSignika:700,300,400,600' rel='stylesheet' type='text/css'>

	<!-- RSS -->
	<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />

</head>


<body>
	<div id="wrap">
  	<!-- Navigation -->
  	<nav id="nav">
	<div id="nav-list">
		<a href="/">Home</a>
		<!-- Nav pages -->
	  
	    
	      <a href="
										/Muestras
								 
								 		" title="Muestras">Muestras</a>
	    
	  
	    
	      <a href="
										/PruebasDelProyecto
								 
								 		" title="Pruebas Notebook">Pruebas Notebook</a>
	    
	  
	    
	      <a href="
										/about
								 
								 		" title="About">About</a>
	    
	  
	    
	  
	    
	      <a href="
										/dask
								 
								 		" title="Dask">Dask</a>
	    
	  
	    
	      <a href="
										/dataframe
								 
								 		" title="DataFrame">DataFrame</a>
	    
	  
	    
	      <a href="
										/hdfs
								 
								 		" title="HDFS">HDFS</a>
	    
	  
	    
	  
	    
	  
	    
	  
	    
	      <a href="
										/pandas
								 
								 		" title="Pandas">Pandas</a>
	    
	  

    <!-- Nav links -->
	  <a href="https://github.com/DataAnalytics171ERE/DataAnalytics171ERE.github.io/archive/DataAnalytics171ERE.github.io-master.zip">Download</a>
<a href="https://github.com/DataAnalytics171ERE/DataAnalytics171ERE.github.io">Project on Github</a>


	</div>

  <!-- Nav footer -->
	
	  <footer>
	
	<span>version 1.1.0</span>

</footer>
	

</nav>

    <!-- Icon menu -->
	  <a id="nav-menu">
	  	<div id="menu"></div>
	  </a>
    <!-- Header -->
    
      <header id="header">
	<a href="/">
		<!--<img src="/img/emerald.svg" alt="Emerald Logo">-->
	  <h1>Pandas y HDFS con DataFrame Dask</h1>
	</a>
</header>

    
    <!-- Main content -->
  	<div id="container">
			<main>
				<article id="page">
	<h2>Pruebas Notebook</h2>
  <p>Para nuestras pruebas usamos dos archivos csv cada uno de 1.8 GB aproximadamente el cual consiste en datos de lo staxis de New York City del año 2015 en los meses de Enero y Febrero.</p>

<h3 id="span-stylecolor-2c3f28-font-family-babas-font-size-1emtaxis-amarillos-nycspan"><span style="color: #2C3F28; font-family: Babas; font-size: 1em;">Taxis amarillos NYC</span></h3>

<p><img src="/img/taxi.png" alt="Pruebas" /></p>

<h3 id="span-stylecolor-2c3f28-font-family-babas-font-size-1emhdfsspan"><span style="color: #2C3F28; font-family: Babas; font-size: 1em;">HDFS</span></h3>
<p>Esos archivos fueron puestos en HDFS local en una laptop dando como resultado lo siguiente :</p>

<p><img src="/img/hdfs1.png" alt="HDFS" /></p>

<h4 id="span-stylecolor-970b0b-font-family-babas-font-size-1em-cdigospan"><span style="color: #970B0B; font-family: Babas; font-size: 1em;"> Código</span></h4>

<p>Vamos a leer uno de los archivos que guardamos en el HDFS (yellow_tripdata_2015-01.csv y yellow_tripdata_2015-02.csv) y los almacenamos con Dataframe Pandas y Dataframe Dask.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">hdfs3</span> <span class="kn">import</span> <span class="n">HDFileSystem</span>
<span class="kn">import</span> <span class="nn">dask.dataframe</span> <span class="kn">as</span> <span class="nn">dd</span> <span class="c">## Dask Dataframe</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="n">hdfs</span> <span class="o">=</span> <span class="n">HDFileSystem</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'localhost'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">9000</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">hdfs</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="s">'/user/data/tripData/'</span><span class="p">))</span>
<span class="k">with</span> <span class="n">hdfs</span><span class="o">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'/user/data/tripData/yellow_tripdata_2015-01.csv'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">nyc20151pd</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">nyc20151</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"hdfs:///user/data/tripData/yellow_tripdata_2015-01.csv"</span><span class="p">,</span> <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span> <span class="s">'port'</span><span class="p">:</span> <span class="mi">9000</span><span class="p">})</span>
<span class="c">#nyc20151.head()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>[{'last_mod': 1494590508, 'size': 1985964692, 'kind': 'file', 'group': 'supergroup', 'last_access': 1495343517,
'block_size': 134217728, 'owner': 'geckolml', 'name': '/user/data/tripData/yellow_tripdata_2015-01.csv',
'permissions': 420, 'replication': 1}, {'last_mod': 1494590599, 'size': 1945357622, 'kind': 'file',
'group': 'supergroup', 'last_access': 1494766894, 'block_size': 134217728, 'owner': 'geckolml',
'name': '/user/data/tripData/yellow_tripdata_2015-02.csv', 'permissions': 420, 'replication': 1}]
</code></pre>
</div>

<blockquote>
  <p>nyc20151pd es Dataframe de Pandas que almacena el .csv guardado en hdfs.</p>
</blockquote>

<blockquote>
  <p>nyc20151 es Dataframe de Dask que almacena el .csv guardado en hdfs.</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">nyc20151</span><span class="o">.</span><span class="n">columns</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>Index(['VendorID', 'tpep_pickup_datetime', 'tpep_dropoff_datetime',
       'passenger_count', 'trip_distance', 'pickup_longitude',
       'pickup_latitude', 'RateCodeID', 'store_and_fwd_flag',
       'dropoff_longitude', 'dropoff_latitude', 'payment_type', 'fare_amount',
       'extra', 'mta_tax', 'tip_amount', 'tolls_amount',
       'improvement_surcharge', 'total_amount'],
      dtype='object')
</code></pre>
</div>

<p>La cantidad de filas en nuestros Dataframe Pandas y Dask en el archivo <strong>yellow_tripdata_2015-01.csv</strong> es 12748986 como se muestra en la columna de abajo</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nyc20151</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nyc20151pd</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>12748986
12748986
</code></pre>
</div>

<p>Podemos observar las cinco primeras filas de los csv almacenados en el HDFS. Cada tupla se refiere a un viaje en un taxi el cual posee los siguientes atributos :</p>

<table>
  <thead>
    <tr>
      <th>Atributo</th>
      <th>Definición</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>VendorID</td>
      <td>Quien provee el grabado 1-Creative Mobile Technologies, 2-VeriFone Inc.</td>
    </tr>
    <tr>
      <td>tpep_pickup_datetime</td>
      <td>La fecha y hora cuando el medidor se activó.</td>
    </tr>
    <tr>
      <td>tpep_dropoff_datetime</td>
      <td>La fecha y hora cuando el medidor se desactivó.</td>
    </tr>
    <tr>
      <td>passenger_count</td>
      <td>Numero de pasajeros en el vehiculo .</td>
    </tr>
    <tr>
      <td>trip_distance</td>
      <td>La distancia en millas que reportó el taximetro.</td>
    </tr>
    <tr>
      <td>pickup_longitude</td>
      <td>Longitud donde el medidor fue activado.</td>
    </tr>
    <tr>
      <td>pickup_latitude</td>
      <td>Latitud donde el medidor fue activado.</td>
    </tr>
    <tr>
      <td>RateCodeID</td>
      <td> </td>
    </tr>
    <tr>
      <td>store_and_fw_flag</td>
      <td> </td>
    </tr>
    <tr>
      <td>dropoff_longitude</td>
      <td>Longitud donde el medidor fue desactivado.</td>
    </tr>
    <tr>
      <td>dropoff_latitude</td>
      <td>Latitud donde el medidor fue activado.</td>
    </tr>
    <tr>
      <td>payment_type</td>
      <td>1=Tarjeta de Credito, 2=Cash, 3=sin cargo, 4=Disputa, 5=Desconocido, 6=Viaje Anulado.</td>
    </tr>
    <tr>
      <td>fare_amount</td>
      <td>Cantidad de tarifa.</td>
    </tr>
    <tr>
      <td>extra</td>
      <td>Cargo extra si es de noche(0.5$) o en hora punta(1$)</td>
    </tr>
    <tr>
      <td>mta_tax</td>
      <td>Impuesto de MTA de $ 0.50 que se activa automáticamente basado en la Tarifa en uso.</td>
    </tr>
    <tr>
      <td>improvement_surcharge</td>
      <td>$ 0.3 de recargo de mejora de los viajes evaluados. El recargo de la mejor comenzo a ser gravado en 2015.</td>
    </tr>
    <tr>
      <td>tip_amount</td>
      <td>Este campo se rellena automaticamente para tarjets de credito. No incluye propinas en efectivo.</td>
    </tr>
    <tr>
      <td>tolls_amount</td>
      <td>Cantidad total de todos los peajes pagados en viaje.</td>
    </tr>
    <tr>
      <td>total_amount</td>
      <td>La cantidad total cobrado a los pasajeros. No incluye consejos de efectivo.</td>
    </tr>
  </tbody>
</table>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">nyc20151</span><span class="o">.</span><span class="n">dtypes</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>VendorID                   int64
tpep_pickup_datetime      object
tpep_dropoff_datetime     object
passenger_count            int64
trip_distance            float64
pickup_longitude         float64
pickup_latitude          float64
RateCodeID                 int64
store_and_fwd_flag        object
dropoff_longitude        float64
dropoff_latitude         float64
payment_type               int64
fare_amount              float64
extra                    float64
mta_tax                  float64
tip_amount               float64
tolls_amount             float64
improvement_surcharge    float64
total_amount             float64
dtype: object
</code></pre>
</div>

<h4 id="span-stylecolor-970b0b-font-family-babas-font-size-15em-evaluamos-los-tiempos-de-ejecucin-entre-dataframe-de-pandas-y-dask-dataframespan"><span style="color: #970B0B; font-family: Babas; font-size: 1.5em;"> Evaluamos los tiempos de ejecución entre Dataframe de pandas y Dask Dataframe</span></h4>

<h5 id="valuecounts">value_counts()</h5>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">timeit</span> <span class="n">nyc20151</span><span class="p">[</span><span class="n">nyc20151</span><span class="o">.</span><span class="n">tip_amount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">payment_type</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>The slowest run took 4.18 times longer than the fastest.
This could mean that an intermediate result is being cached.
100 loops, best of 3: 1.95 ms per loop
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">timeit</span> <span class="n">nyc20151pd</span><span class="p">[</span><span class="n">nyc20151pd</span><span class="o">.</span><span class="n">tip_amount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">payment_type</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>1 loop, best of 3: 987 ms per loop
</code></pre>
</div>

<h5 id="sum">sum()</h5>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">timeit</span> <span class="n">nyc20151</span><span class="o">.</span><span class="n">passenger_count</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>1000 loops, best of 3: 613 µs per loop
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">timeit</span> <span class="n">nyc20151pd</span><span class="o">.</span><span class="n">passenger_count</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>100 loops, best of 3: 11.7 ms per loop
</code></pre>
</div>

<h5 id="numero-de-filas">Numero de filas</h5>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">timeit</span> <span class="nb">len</span><span class="p">(</span><span class="n">nyc20151</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>1 loop, best of 3: 26.9 s per loop
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">timeit</span> <span class="nb">len</span><span class="p">(</span><span class="n">nyc20151pd</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>The slowest run took 54660.36 times longer than the fastest.
This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 969 ns per loop
</code></pre>
</div>

<h4 id="convirtiendo-el-tipo-de-datos-series-a-datatime-en-las-columnas-tpeppickupdatetime-y-tpepdropoffdatetime">Convirtiendo el tipo de datos Series a datatime en las columnas tpep_pickup_datetime y tpep_dropoff_datetime</h4>

<h4 id="dataframe-pandas">Dataframe Pandas</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">nyc20151pd</span><span class="p">[[</span><span class="s">'tpep_pickup_datetime'</span><span class="p">,</span><span class="s">'tpep_dropoff_datetime'</span><span class="p">]]</span><span class="o">=</span><span class="n">nyc20151pd</span><span class="p">[[</span><span class="s">'tpep_pickup_datetime'</span><span class="p">,</span>
                                             <span class="s">'tpep_dropoff_datetime'</span><span class="p">]]</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">nyc20151pd</span><span class="o">.</span><span class="n">dtypes</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>VendorID                          int64
tpep_pickup_datetime     datetime64[ns]
tpep_dropoff_datetime    datetime64[ns]
passenger_count                   int64
trip_distance                   float64
pickup_longitude                float64
pickup_latitude                 float64
RateCodeID                        int64
store_and_fwd_flag               object
dropoff_longitude               float64
dropoff_latitude                float64
payment_type                      int64
fare_amount                     float64
extra                           float64
mta_tax                         float64
tip_amount                      float64
tolls_amount                    float64
improvement_surcharge           float64
total_amount                    float64
dtype: object
</code></pre>
</div>

<h4 id="dataframe-dask">Dataframe Dask</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">nyc20151</span><span class="o">.</span><span class="n">tpep_pickup_datetime</span><span class="o">=</span><span class="n">nyc20151</span><span class="o">.</span><span class="n">tpep_pickup_datetime</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'datetime64[ns]'</span><span class="p">)</span>
<span class="n">nyc20151</span><span class="o">.</span><span class="n">tpep_dropoff_datetime</span><span class="o">=</span><span class="n">nyc20151</span><span class="o">.</span><span class="n">tpep_dropoff_datetime</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'datetime64[ns]'</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">nyc20151</span><span class="o">.</span><span class="n">dtypes</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>VendorID                          int64
tpep_pickup_datetime     datetime64[ns]
tpep_dropoff_datetime    datetime64[ns]
passenger_count                   int64
trip_distance                   float64
pickup_longitude                float64
pickup_latitude                 float64
RateCodeID                        int64
store_and_fwd_flag               object
dropoff_longitude               float64
dropoff_latitude                float64
payment_type                      int64
fare_amount                     float64
extra                           float64
mta_tax                         float64
tip_amount                      float64
tolls_amount                    float64
improvement_surcharge           float64
total_amount                    float64
dtype: object
</code></pre>
</div>

<h4 id="span-stylecolor-970b0b-font-family-babas-font-size-18empreguntas-respuestas-y-comparacionesspan"><span style="color: #970B0B; font-family: Babas; font-size: 1.8em;">Preguntas, respuestas y comparaciones</span></h4>
<hr />

<h4 id="qu-das-de-la-semana-tienen-mayor-numero-de-pasajeros-los-taxis-de-nyc">¿Qué días de la semana tienen mayor numero de pasajeros los taxis de NYC?</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">nyc20151pd</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">nyc20151pd</span><span class="o">.</span><span class="n">tpep_pickup_datetime</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span><span class="p">)</span><span class="o">.</span><span class="n">passenger_count</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>tpep_pickup_datetime
0    2200087
1    2260433
2    2758308
3    3621723
4    3732988
5    4141314
6    2722450
Name: passenger_count, dtype: int64
</code></pre>
</div>

<blockquote>
  <p>Repuesta : Los sábados son los dias en que hay mayor flujo de pasajeros en los taxis de NYC.</p>
</blockquote>

<h4 id="span-stylecolor-006633-font-family-babas-font-size-115emcomparacin-de-tiempospan"><span style="color: #006633; font-family: Babas; font-size: 1.15em;">Comparación de tiempo:</span></h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">timeit</span> <span class="n">nyc20151</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">nyc20151</span><span class="o">.</span><span class="n">tpep_pickup_datetime</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span><span class="p">)</span><span class="o">.</span><span class="n">passenger_count</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>The slowest run took 158.63 times longer than the fastest.
This could mean that an intermediate result is being cached.
1 loop, best of 3: 3.07 ms per loop
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">timeit</span> <span class="n">nyc20151pd</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">nyc20151pd</span><span class="o">.</span><span class="n">tpep_pickup_datetime</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span><span class="p">)</span><span class="o">.</span><span class="n">passenger_count</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>1 loop, best of 3: 786 ms per loop
</code></pre>
</div>

<h4 id="qu-das-de-la-semana-tienen-mayor-numero-de-propinas-los-taxis-de-nyc">¿Qué días de la semana tienen mayor numero de propinas los taxis de NYC?</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">nyc20151pd</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">nyc20151pd</span><span class="o">.</span><span class="n">tpep_pickup_datetime</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span><span class="p">)</span><span class="o">.</span><span class="n">tip_amount</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>

</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>tpep_pickup_datetime
0    2.096523e+06
1    2.162308e+06
2    2.740310e+06
3    3.487074e+06
4    3.485685e+06
5    3.322782e+06
6    6.339563e+06
Name: tip_amount, dtype: float64
</code></pre>
</div>

<blockquote>
  <p>Respuesta : Los días Domingos los taxistas de NYC reciben mas propinas.</p>
</blockquote>

<h4 id="span-stylecolor-006633-font-family-babas-font-size-115emcomparacin-de-tiempo--span"><span style="color: #006633; font-family: Babas; font-size: 1.15em;">Comparación de tiempo : </span></h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">timeit</span> <span class="n">nyc20151</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">nyc20151</span><span class="o">.</span><span class="n">tpep_pickup_datetime</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span><span class="p">)</span><span class="o">.</span><span class="n">tip_amount</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>100 loops, best of 3: 3.34 ms per loop
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">timeit</span> <span class="n">nyc20151pd</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">nyc20151pd</span><span class="o">.</span><span class="n">tpep_pickup_datetime</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span><span class="p">)</span><span class="o">.</span><span class="n">tip_amount</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>The slowest run took 10.59 times longer than the fastest.
This could mean that an intermediate result is being cached.
1 loop, best of 3: 837 ms per loop
</code></pre>
</div>

<h4 id="salida-de-taxis-con-posicion">Salida de taxis con posicion</h4>

<h4 id="span-stylecolor-006633-font-family-babas-font-size-115emcomparacin-de-tiempospan-1"><span style="color: #006633; font-family: Babas; font-size: 1.15em;">Comparación de tiempo</span></h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">timeit</span> <span class="n">nyc20151</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">'tpep_pickup_datetime'</span><span class="p">,</span><span class="s">'pickup_longitude'</span><span class="p">,</span><span class="s">'pickup_latitude'</span><span class="p">])</span><span class="o">.</span><span class="n">passenger_count</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>100 loops, best of 3: 2.9 ms per loop
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">timeit</span> <span class="n">nyc20151pd</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">'tpep_pickup_datetime'</span><span class="p">,</span><span class="s">'pickup_longitude'</span><span class="p">,</span><span class="s">'pickup_latitude'</span><span class="p">])</span><span class="o">.</span><span class="n">passenger_count</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>1 loop, best of 3: 8.58 s per loop
</code></pre>
</div>

<h4 id="span-stylecolor-970b0b-font-family-babas-font-size-15emgrficas-tiempo-de-comparacin-dask-dataframe-y-pandas-dataframespan"><span style="color: #970B0B; font-family: Babas; font-size: 1.5em;">Gráficas Tiempo de Comparación Dask Dataframe y Pandas Dataframe</span></h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span>
<span class="n">timeNyc20151</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">'total'</span><span class="p">:[</span><span class="mf">1.95</span><span class="p">,</span><span class="mf">0.613</span><span class="p">,</span><span class="mf">26.9</span><span class="p">,</span><span class="mf">3.07</span><span class="p">,</span><span class="mf">3.34</span><span class="p">,</span><span class="mf">2.9</span><span class="p">],</span>
                                 <span class="s">'abbrev'</span><span class="p">:</span>
                           <span class="p">[</span><span class="s">'value_counts'</span><span class="p">,</span><span class="s">'sum()'</span><span class="p">,</span><span class="s">'nrows'</span><span class="p">,</span>
                           <span class="s">'pasajerosPorDiaSemana'</span><span class="p">,</span><span class="s">'PropinasPorDiaSemana'</span><span class="p">,</span>
                           <span class="s">'salidaTaxisMismaPosicion'</span><span class="p">]})</span>
<span class="n">timeNyc20151pd</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">'total'</span><span class="p">:[</span><span class="mi">987</span><span class="p">,</span><span class="mf">11.7</span><span class="p">,</span><span class="mf">0.969</span><span class="p">,</span><span class="mi">786</span><span class="p">,</span><span class="mi">837</span><span class="p">,</span><span class="mf">8.58</span><span class="p">],</span>
                                   <span class="s">'abbrev'</span><span class="p">:[</span><span class="s">'value_counts'</span><span class="p">,</span><span class="s">'sum()'</span><span class="p">,</span><span class="s">'nrows'</span><span class="p">,</span>
                                   <span class="s">'pasajerosPorDiaSemana'</span><span class="p">,</span><span class="s">'PropinasPorDiaSemana'</span><span class="p">,</span>
                                   <span class="s">'salidaTaxisMismaPosicion'</span><span class="p">]})</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">sns</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s">"whitegrid"</span><span class="p">)</span>
<span class="c"># Initialize the matplotlib figure</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c"># Plot the time Dataframe Pandas</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_color_codes</span><span class="p">(</span><span class="s">"muted"</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">"total"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"abbrev"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">timeNyc20151pd</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s">"Dataframe Pandas"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"b"</span><span class="p">)</span>

<span class="c"># Plot the time Dataframe Dask</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_color_codes</span><span class="p">(</span><span class="s">"pastel"</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">"total"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"abbrev"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">timeNyc20151</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s">"Dataframe Dask"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"b"</span><span class="p">)</span> <span class="c"># "x" es valor y "y" es la etiqueta</span>



<span class="c"># Add a legend and informative axis label</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s">"lower right"</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span> <span class="n">ylabel</span><span class="o">=</span><span class="s">""</span><span class="p">,</span>
       <span class="n">xlabel</span><span class="o">=</span><span class="s">"Tiempo de ejecucion en ms"</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>
</div>

<p><img src="/img/output_45_0.png" alt="Comparacion" /></p>

<h3 id="grafica-distancia-de-viaje-vs-precio-total">Grafica Distancia de Viaje vs Precio Total</h3>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>


<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">factorplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">"trip_distance"</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s">"total_amount"</span><span class="p">,</span>
<span class="n">data</span><span class="o">=</span><span class="n">nyc20151</span><span class="p">[(</span><span class="n">nyc20151</span><span class="o">.</span><span class="n">payment_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nyc20151</span><span class="o">.</span><span class="n">passenger_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">"bar"</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s">"muted"</span><span class="p">)</span>

<span class="n">g</span><span class="o">.</span><span class="n">set_titles</span><span class="p">(</span><span class="s">"Grafica"</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">set_xlabels</span><span class="p">(</span><span class="s">"Distancia de Viaje(Millas)"</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">set_ylabels</span><span class="p">(</span><span class="s">"Precio Total($)"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'Distancia de Viaje vs Precio Total ( Transporte en taxi NYC)'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


</code></pre>
</div>

<p><img src="/img/output_12_0.png" alt="Grafico" /></p>

<h3 id="datos">Datos:</h3>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">nyc20151</span><span class="p">[[</span><span class="s">'VendorID'</span><span class="p">,</span><span class="s">'trip_distance'</span><span class="p">,</span><span class="s">'total_amount'</span><span class="p">]]</span>
<span class="p">[(</span><span class="n">nyc20151</span><span class="o">.</span><span class="n">payment_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nyc20151</span><span class="o">.</span><span class="n">passenger_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</code></pre>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>VendorID</th>
      <th>trip_distance</th>
      <th>total_amount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1.80</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>0.50</td>
      <td>4.8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>3.00</td>
      <td>16.3</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>2.20</td>
      <td>15.3</td>
    </tr>
    <tr>
      <th>12</th>
      <td>1</td>
      <td>0.30</td>
      <td>4.3</td>
    </tr>
    <tr>
      <th>14</th>
      <td>1</td>
      <td>1.10</td>
      <td>7.3</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2</td>
      <td>3.60</td>
      <td>19.3</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2</td>
      <td>1.53</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>36</th>
      <td>1</td>
      <td>2.90</td>
      <td>14.3</td>
    </tr>
    <tr>
      <th>38</th>
      <td>2</td>
      <td>0.02</td>
      <td>3.8</td>
    </tr>
    <tr>
      <th>39</th>
      <td>2</td>
      <td>1.73</td>
      <td>12.3</td>
    </tr>
    <tr>
      <th>41</th>
      <td>2</td>
      <td>3.53</td>
      <td>13.8</td>
    </tr>
    <tr>
      <th>49</th>
      <td>2</td>
      <td>0.49</td>
      <td>5.3</td>
    </tr>
    <tr>
      <th>53</th>
      <td>2</td>
      <td>1.10</td>
      <td>7.3</td>
    </tr>
    <tr>
      <th>58</th>
      <td>2</td>
      <td>10.20</td>
      <td>40.3</td>
    </tr>
    <tr>
      <th>60</th>
      <td>2</td>
      <td>0.03</td>
      <td>3.3</td>
    </tr>
    <tr>
      <th>62</th>
      <td>2</td>
      <td>0.36</td>
      <td>4.3</td>
    </tr>
    <tr>
      <th>66</th>
      <td>2</td>
      <td>0.85</td>
      <td>6.3</td>
    </tr>
    <tr>
      <th>75</th>
      <td>2</td>
      <td>1.39</td>
      <td>8.3</td>
    </tr>
    <tr>
      <th>76</th>
      <td>2</td>
      <td>1.64</td>
      <td>9.3</td>
    </tr>
  </tbody>
</table>
</div>

<h1 id="numero-de-pasajeros-en-taxis-por-hora">Numero de pasajeros en taxis por Hora</h1>

<p>Agruparemos los taxis por dia y sumaremos todos los pasajeros para mostrar</p>

<p>vendorID tpep_pickup_datetime passenger_count</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">qwerty</span><span class="o">=</span><span class="n">nyc20151pd</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">nyc20151pd</span><span class="o">.</span><span class="n">tpep_pickup_datetime</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span><span class="o">.</span><span class="n">passenger_count</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span>
<span class="n">qwerty</span><span class="o">.</span><span class="n">head</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;bound method Series.head of tpep_pickup_datetime
0      812590
1      614577
2      464257
3      345682
4      245561
5      204041
6      415329
7      724645
8      909290
9      943225
10     937121
11     996254
12    1068850
13    1072042
14    1112355
15    1103702
16     979060
17    1127840
18    1346525
19    1362960
20    1240139
21    1211079
22    1179532
23    1020647
Name: passenger_count, dtype: int64&gt;
</code></pre>
</div>

<blockquote>
  <p>Respuesta : Se consideraria hora punta a las 17 horas debido</p>
</blockquote>

<blockquote>
  <p>a su gran numero de pasajeros en los taxis en NYC.</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code>
</code></pre>
</div>

<p><a href="/">back to the homepage</a>.</p>

</article>

		  </main>
		  <!-- Pagination links -->
      
	  </div>
    <!-- Footer -->
    <footer><span>@2017 - Peinado - Cerrón - Huaranga</span></footer>

    <!-- Script -->
    <script src="/js/main.js"></script>
<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAshrPQZQF48Ql_8W2QUNRY4h1iu6Ra8n8&libraries=visualization&callback=initMap">
</script>

	</div>
</body>
</html>
